Документация по модулю fias
============================

Модуль fias предназначен для работы с государственным адресным реестром http://fias.nalog.ru/ 
НЕ ИСПОЛЬЗУЕТ СПРАВОЧНИК НОМЕРОВ ДОМОВ!

Структура модуля
-------------------

    actions             содержит действия               
    console             содержит логику для работы приложения в консоли
        base            содержит модели необходимые для работы модуля в консоли
        controllers     содержит контроллер консольных команд
        models          содержит модели для работы с данными в консоли
        traits          содержит трейты
    controllers         содержит основные контроллеры модуля
    helpers             содержит классы хелперы
    models              сожержит основные модели модуля
    searches            содержит модели поиска
    widgets             содержит виджеты модуля
    Module.php          базовый класс модуля
    
Зависимости
-------------------

Модулю для работы нужно официальное jquery ui расширение (yiisoft/yii2-jui).

Установка
-------------------
Установить модуль с помощью композера, внести изменения в composer.json:
````
    "repositories":
        [
            {
                "type": "vcs",
                "url": "https://github.com/b059ae/yii2-fias"
            }
        ],
    "require": {
        "solbianca/yii2-fias": "dev-dev"
    }
````

 Применить миграции:
 ````
     php yii migrate/up --migrationPath=@vendor/solbianca/yii2-fias/migrations
 ````
Настройки
-------------------

В файле конфига необходимо подключить модуль:
    
````
    'modules' => [
        ....
            'fias' => [
                'class' => 'solbianca\fias\Module',
                //'directory' => 'path/to/directory' // Папка для хранения файлов XML ФИАС. По умолчанию @app/runtime/fias
            ],
        ....
    ],
````  

Задать карту контроллеров:

````
'controllerMap' => [
    'fias' => [
        'class' => 'solbianca\fias\console\controllers\FiasController'
    ]
],
````


Консольные команды
-------------------

Для инициализации базы данных fias необходимо набрать команду. Предварительно скачиваем базу, распаковываем, заливаем на сервер и указываем путь до нее в консольной команде.
Есть возможность скачивать файл при установке, но занимает очень много времени (для этого следует пропустить параметр /path/to/files и НОМЕР_ВЕРСИИ).
Базу скачивать в формате XML. Страница скачки https://fias.nalog.ru/Updates.aspx
````
    php yii fias/install /path/to/files НОМЕР_ВЕРСИИ
````
В силу того что база имеет большой размер (около 4 гигабайт без номеров домов), импорт полной базы может продолжаться длительное время, десятки минут.
Построение индексов проходит после импорта БД.


Для обновления данных базы fias используется команда. Приложение сммотрит последнюю версию данных на сервере и версию импоритрованную на сервер.
Если они различны, скачивает последнюю версию delta_fias и применяет ее.
````
    php yii fias/update
````

Очистить директорию для скачки/распаковывания файлов (по умолчанию @app/runtime/fias):
````
    php yii fias/clear-directory
````

Виджет
-----------------------

Для того что бы использовать виджет необходимо в нужном файле представления прописать:

````
<?=\solbianca\fias\widgets\autocomplete\Autocomplete::widget(['url'=>'/account/autocomplete']);?>
````

Экшн для поиска
````
    public function actions()
    {
        return [
            'autocomplete' => '\solbianca\fias\actions\AutocompleteAction',
        ];
    }
````
-----------------------
